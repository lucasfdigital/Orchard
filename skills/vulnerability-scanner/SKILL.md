---
name: vulnerability-scanner
description: PrincÃ­pios avanÃ§ados de anÃ¡lise de vulnerabilidade. OWASP 2025, SeguranÃ§a da Cadeia de Suprimentos (Supply Chain), mapeamento de superfÃ­cie de ataque e priorizaÃ§Ã£o de riscos.
allowed-tools: Read, Glob, Grep, Bash
---

# Scanner de Vulnerabilidades

> Pense como um atacante, defenda como um especialista. ConsciÃªncia do cenÃ¡rio de ameaÃ§as de 2025.

---

## ğŸ”§ Scripts de Runtime

**Execute para validaÃ§Ã£o automatizada:**

| Script | PropÃ³sito | Uso |
| :--- | :--- | :--- |
| `scripts/security_scan.py` | Validar os princÃ­pios de seguranÃ§a aplicados | `python scripts/security_scan.py <caminho_do_projeto>` |

## ğŸ“‹ Arquivos de ReferÃªncia

| Arquivo | PropÃ³sito |
| :--- | :--- |
| [checklists.md](checklists.md) | Checklists do OWASP Top 10, AutenticaÃ§Ã£o, API e ProteÃ§Ã£o de Dados |

---

## 1. Mentalidade de Especialista em SeguranÃ§a

### PrincÃ­pios Centrais

| PrincÃ­pio | AplicaÃ§Ã£o |
| :--- | :--- |
| **Assume Breach** (Assuma a InvasÃ£o) | Projete como se o atacante jÃ¡ estivesse dentro |
| **Zero Trust** (ConfianÃ§a Zero) | Nunca confie, sempre verifique |
| **Defesa em Profundidade** | MÃºltiplas camadas, sem ponto Ãºnico de falha |
| **PrivilÃ©gio MÃ­nimo** | Apenas o acesso mÃ­nimo necessÃ¡rio |
| **Fail Secure** | Em caso de erro, negue o acesso |

### Perguntas de Modelagem de AmeaÃ§as

Antes de escanear, pergunte:
1. O que estamos protegendo? (Ativos/Assets)
2. Quem atacaria? (Atores de ameaÃ§a)
3. Como eles atacariam? (Vetores de ataque)
4. Qual Ã© o impacto? (Risco de negÃ³cio)

---

## 2. OWASP Top 10:2025

### Categorias de Risco

| Rank | Categoria | Pense Sobre |
| :--- | :--- | :--- |
| **A01** | Quebra de Controle de Acesso | Quem pode acessar o quÃª? IDOR, SSRF |
| **A02** | ConfiguraÃ§Ã£o Incorreta de SeguranÃ§a| PadrÃµes, headers, serviÃ§os expostos |
| **A03** | Cadeia de Suprimentos de Software ğŸ†•| DependÃªncias, CI/CD, integridade do build |
| **A04** | Falhas CriptogrÃ¡ficas | Cripto fraca, segredos expostos |
| **A05** | InjeÃ§Ã£o | Entrada do usuÃ¡rio â†’ comandos do sistema |
| **A06** | Design Inseguro | Arquitetura falha |
| **A07** | Falhas de AutenticaÃ§Ã£o | Gerenciamento de sessÃ£o e credenciais |
| **A08** | Falhas de Integridade | AtualizaÃ§Ãµes nÃ£o assinadas, dados adulterados|
| **A09** | Logging e Alerta | Pontos cegos, falta de monitoramento |
| **A10** | CondiÃ§Ãµes Excepcionais ğŸ†• | Tratamento de erro, estados fail-open |

### MudanÃ§as Chave em 2025

```
MudanÃ§as de 2021 â†’ 2025:
â”œâ”€â”€ SSRF mesclado ao A01 (Controle de Acesso)
â”œâ”€â”€ A02 elevado (ConfiguraÃ§Ãµes de Nuvem/Container)
â”œâ”€â”€ A03 NOVO: Cadeia de Suprimentos (foco principal)
â”œâ”€â”€ A10 NOVO: CondiÃ§Ãµes Excepcionais
â””â”€â”€ MudanÃ§a de foco: Causas Raiz > Sintomas
```

---

## 3. SeguranÃ§a da Cadeia de Suprimentos (A03)

### SuperfÃ­cie de Ataque

| Vetor | Risco | Pergunta a Fazer |
| :--- | :--- | :--- |
| **DependÃªncias** | Pacotes maliciosos | Auditamos novas dependÃªncias? |
| **Lock files** | Ataques de integridade | Eles estÃ£o no repositÃ³rio? |
| **Pipeline de build**| Compromisso do CI/CD | Quem pode modificar? |
| **Registro (Registry)**| Typosquatting | Fontes verificadas? |

### PrincÃ­pios de Defesa

- Verifique a integridade do pacote (checksums).
- Fixe (pin) as versÃµes, audite as atualizaÃ§Ãµes.
- Use registros privados para dependÃªncias crÃ­ticas.
- Assine e verifique os artefatos.

---

## 4. Mapeamento da SuperfÃ­cie de Ataque

### O que Mapear

| Categoria | Elementos |
| :--- | :--- |
| **Pontos de Entrada** | APIs, formulÃ¡rios, uploads de arquivos |
| **Fluxos de Dados** | Entrada â†’ Processo â†’ SaÃ­da |
| **Limites de ConfianÃ§a**| Onde AutenticaÃ§Ã£o/AutorizaÃ§Ã£o sÃ£o checadas|
| **Ativos (Assets)** | Segredos, PII (Dados Pessoais), dados de negÃ³cio|

### Matriz de PriorizaÃ§Ã£o

```
Risco = Probabilidade Ã— Impacto

Alto Impacto + Alta Probabilidade â†’ CRÃTICO
Alto Impacto + Baixa Probabilidade â†’ ALTO
Baixo Impacto + Alta Probabilidade â†’ MÃ‰DIO
Baixo Impacto + Baixa Probabilidade â†’ BAIXO
```

---

## 5. PriorizaÃ§Ã£o de Risco

### CVSS + Contexto

| Fator | Peso | Pergunta |
| :--- | :--- | :--- |
| **Score CVSS** | Gravidade base | QuÃ£o grave Ã© a vulnerabilidade? |
| **Score EPSS** | Probabilidade de exploit | EstÃ¡ sendo explorada no mundo real? |
| **Valor do Ativo** | Contexto de negÃ³cio | O que estÃ¡ em risco? |
| **ExposiÃ§Ã£o** | SuperfÃ­cie de ataque | Exposto Ã  Internet? |

### Ãrvore de DecisÃ£o de PriorizaÃ§Ã£o

```
EstÃ¡ sendo explorada ativamente (EPSS >0.5)?
â”œâ”€â”€ SIM â†’ CRÃTICO: AÃ§Ã£o imediata
â””â”€â”€ NÃƒO â†’ Verifique o CVSS
         â”œâ”€â”€ CVSS â‰¥9.0 â†’ ALTO
         â”œâ”€â”€ CVSS 7.0-8.9 â†’ Considere o valor do ativo
         â””â”€â”€ CVSS <7.0 â†’ Agendar para depois
```

---

## 6. CondiÃ§Ãµes Excepcionais (A10 - Novo)

### Fail-Open vs Fail-Closed

| CenÃ¡rio | Fail-Open (RUIM) | Fail-Closed (BOM) |
| :--- | :--- | :--- |
| Erro de AutenticaÃ§Ã£o | Permite o acesso | Nega o acesso |
| Falha no parsing | Aceita a entrada | Rejeita a entrada |
| Timeout | Tenta para sempre | Limita + aborta |

### O que verificar

- Handlers de exceÃ§Ã£o que capturam tudo (catch-all) e ignoram.
- Falta de tratamento de erro em operaÃ§Ãµes de seguranÃ§a.
- CondiÃ§Ãµes de corrida (race conditions) em AutenticaÃ§Ã£o/AutorizaÃ§Ã£o.
- CenÃ¡rios de exaustÃ£o de recursos.

---

## 7. Metodologia de Escaneamento

### Abordagem Baseada em Fases

```
1. RECONHECIMENTO
   â””â”€â”€ Entender o alvo
       â”œâ”€â”€ Stack de tecnologia
       â”œâ”€â”€ Pontos de entrada
       â”œâ”€â”€ Fluxos de dados

2. DESCOBERTA
   â””â”€â”€ Identificar problemas potenciais
       â”œâ”€â”€ RevisÃ£o de configuraÃ§Ã£o
       â”œâ”€â”€ AnÃ¡lise de dependÃªncias
       â”œâ”€â”€ Busca por padrÃµes de cÃ³digo

3. ANÃLISE
   â””â”€â”€ Validar e priorizar
       â”œâ”€â”€ EliminaÃ§Ã£o de falsos positivos
       â”œâ”€â”€ PontuaÃ§Ã£o de risco
       â”œâ”€â”€ Mapeamento da cadeia de ataque

4. RELATÃ“RIO
   â””â”€â”€ Descobertas acionÃ¡veis
       â”œâ”€â”€ Passos claros para reproduÃ§Ã£o
       â”œâ”€â”€ Impacto de negÃ³cio
       â”œâ”€â”€ Guia para remediaÃ§Ã£o
```

---

## 8. AnÃ¡lise de PadrÃµes de CÃ³digo

### PadrÃµes de Alto Risco

| PadrÃ£o | Risco | O que procurar |
| :--- | :--- | :--- |
| **ConcatenaÃ§Ã£o de strings em queries**| InjeÃ§Ã£o | `"SELECT * FROM " + entrada_usuario` |
| **ExecuÃ§Ã£o de cÃ³digo dinÃ¢mico** | RCE | `eval()`, `exec()`, `Function()` |
| **DesserializaÃ§Ã£o insegura** | RCE | `pickle.loads()`, `unserialize()` |
| **ManipulaÃ§Ã£o de caminho (path)** | Traversal | Entrada do usuÃ¡rio em caminhos de arquivo |
| **SeguranÃ§a desativada** | VÃ¡rios | `verify=False`, `--insecure` |

### PadrÃµes de Segredos (Secrets)

| Tipo | Indicadores |
| :--- | :--- |
| API Keys | `api_key`, `apikey`, alta entropia |
| Tokens | `token`, `bearer`, `jwt` |
| Credenciais | `password`, `secret`, `key` |
| Nuvem (Cloud) | Prefixos `AWS_`, `AZURE_`, `GCP_` |

---

## 9. ConsideraÃ§Ãµes de SeguranÃ§a em Nuvem (Cloud)

### Responsabilidade Compartilhada

| Camada | VocÃª Ã© Dono | Provedor Ã© Dono |
| :--- | :--- | :--- |
| Dados | âœ… | âŒ |
| AplicaÃ§Ã£o | âœ… | âŒ |
| SO/Runtime | Depende | Depende |
| Infraestrutura | âŒ | âœ… |

---

## 10. Anti-PadrÃµes

| âŒ NÃƒO FaÃ§a | âœ… FaÃ§a |
| :--- | :--- |
| Escanear sem entender | Mapeie a superfÃ­cie de ataque primeiro |
| Alerta para cada CVE | Priorize por explorabilidade + ativo |
| Ignorar falsos positivos | Mantenha uma base verificada |
| Corrigir apenas sintomas | Aborde as causas raiz |
| Escanear uma vez antes do deploy | Escaneamento contÃ­nuo |
| Confiar cegamente em terceiros | Verifique a integridade, audite o cÃ³digo |

---

## 11. PrincÃ­pios de RelatÃ³rios

### Estrutura da Descoberta

Cada descoberta deve responder:
1. **O quÃª?** - DescriÃ§Ã£o clara da vulnerabilidade.
2. **Onde?** - LocalizaÃ§Ã£o exata (arquivo, linha, endpoint).
3. **Por quÃª?** - ExplicaÃ§Ã£o da causa raiz.
4. **Impacto?** - ConsequÃªncia para o negÃ³cio.
5. **Como corrigir?** - RemediaÃ§Ã£o especÃ­fica.

### ClassificaÃ§Ã£o de Gravidade

| Gravidade | CritÃ©rios |
| :--- | :--- |
| **CrÃ­tica** | RCE, bypass de autenticaÃ§Ã£o, vazamento massivo de dados |
| **Alta** | Vazamento de dados, escalada de privilÃ©gios |
| **MÃ©dia** | Escopo limitado, requer condiÃ§Ãµes especÃ­ficas |
| **Baixa** | Informativa, melhor prÃ¡tica |

---

> **Lembre-se:** O escaneamento de vulnerabilidades encontra os problemas. O pensamento especialista prioriza o que importa. Sempre pergunte: "O que um atacante faria com isso?"
